(function(){var l,m,n,r,o,j,i,p,t,s,k=Array.prototype.slice,u=Array.prototype.indexOf||function(c){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===c)return a;return-1},v=Object.prototype.hasOwnProperty,q=function(c,a){function b(){this.constructor=c}for(var e in a)v.call(a,e)&&(c[e]=a[e]);b.prototype=a.prototype;c.prototype=new b;c.__super__=a.prototype;return c},w=function(c,a){return function(){return c.apply(a,arguments)}};n={bind:function(c,a){var b,e,d,f,g;e=c.split(" ");b=this.hasOwnProperty("_callbacks")&&
this._callbacks||(this._callbacks={});f=0;for(g=e.length;f<g;f++)d=e[f],b[d]||(b[d]=[]),b[d].push(a);return this},one:function(c,a){return this.bind(c,function(){this.unbind(c,arguments.callee);return a.apply(this,arguments)})},trigger:function(){var c,a,b,e,d;c=1<=arguments.length?k.call(arguments,0):[];b=c.shift();if(b=this.hasOwnProperty("_callbacks")&&(null!=(a=this._callbacks)?a[b]:void 0)){e=0;for(d=b.length;e<d&&!(a=b[e],!1===a.apply(this,c));e++);return!0}},unbind:function(c,a){var b,e,d,
f;if(!c)return this._callbacks={},this;d=null!=(b=this._callbacks)?b[c]:void 0;if(!d)return this;if(!a)return delete this._callbacks[c],this;e=0;for(f=d.length;e<f;e++)if(b=d[e],b===a){d=d.slice();d.splice(e,1);this._callbacks[c]=d;break}return this}};r={trace:!0,logPrefix:"(App)",log:function(){var c;c=1<=arguments.length?k.call(arguments,0):[];if(this.trace)return this.logPrefix&&c.unshift(this.logPrefix),"undefined"!==typeof console&&null!==console&&"function"===typeof console.log&&console.log.apply(console,
c),this}};s=["included","extended"];j=function(){function c(){"function"===typeof this.init&&this.init.apply(this,arguments)}c.include=function(a){var b,e,d;if(!a)throw"include(obj) requires obj";for(b in a)e=a[b],0>u.call(s,b)&&(this.prototype[b]=e);null!=(d=a.included)&&d.apply(this);return this};c.extend=function(a){var b,e,d;if(!a)throw"extend(obj) requires obj";for(b in a)e=a[b],0>u.call(s,b)&&(this[b]=e);null!=(d=a.extended)&&d.apply(this);return this};c.proxy=function(a){var b=this;return function(){return a.apply(b,
arguments)}};c.prototype.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}};return c}();o=function(c){function a(b){a.__super__.constructor.apply(this,arguments);b&&this.load(b);this.cid||(this.cid="c-"+this.constructor.uid())}q(a,c);a.extend(n);a.records={};a.crecords={};a.attributes=[];a.configure=function(){var b,e;e=arguments[0];b=2<=arguments.length?k.call(arguments,1):[];this.className=e;this.records={};this.crecords={};b.length&&(this.attributes=b);this.attributes&&
(this.attributes=t(this.attributes));this.attributes||(this.attributes=[]);this.unbind();return this};a.toString=function(){return""+this.className+"("+this.attributes.join(", ")+")"};a.find=function(b){var e;e=this.records[b];if(!e&&(""+b).match(/c-\d+/))return this.findCID(b);if(!e)throw"Unknown record";return e.clone()};a.findCID=function(b){b=this.crecords[b];if(!b)throw"Unknown record";return b.clone()};a.exists=function(b){try{return this.find(b)}catch(e){return!1}};a.refresh=function(b,e){var a,
f,c,h;null==e&&(e={});e.clear&&(this.records={},this.crecords={});f=this.fromJSON(b);p(f)||(f=[f]);c=0;for(h=f.length;c<h;c++)a=f[c],a.id||(a.id=a.cid),this.records[a.id]=a,this.crecords[a.cid]=a;this.trigger("refresh",!e.clear&&this.cloneArray(f));return this};a.select=function(b){var e,a,f,c;f=this.records;c=[];for(e in f)a=f[e],b(a)&&c.push(a);return this.cloneArray(c)};a.findByAttribute=function(b,e){var a,f,c;c=this.records;for(a in c)if(f=c[a],f[b]===e)return f.clone();return null};a.findAllByAttribute=
function(b,e){return this.select(function(a){return a[b]===e})};a.each=function(b){var e,a,f,c;f=this.records;c=[];for(e in f)a=f[e],c.push(b(a.clone()));return c};a.all=function(){return this.cloneArray(this.recordsValues())};a.first=function(){var b;b=this.recordsValues()[0];return null!=b?b.clone():void 0};a.last=function(){var b;b=this.recordsValues();b=b[b.length-1];return null!=b?b.clone():void 0};a.count=function(){return this.recordsValues().length};a.deleteAll=function(){var b,e,a;e=this.records;
a=[];for(b in e)a.push(delete this.records[b]);return a};a.destroyAll=function(){var b,e,a;e=this.records;a=[];for(b in e)a.push(this.records[b].destroy());return a};a.update=function(b,a,d){return this.find(b).updateAttributes(a,d)};a.create=function(b,a){return(new this(b)).save(a)};a.destroy=function(b,a){return this.find(b).destroy(a)};a.change=function(b){return"function"===typeof b?this.bind("change",b):this.trigger("change",b)};a.fetch=function(b){return"function"===typeof b?this.bind("fetch",
b):this.trigger("fetch",b)};a.toJSON=function(){return this.recordsValues()};a.fromJSON=function(b){var a,d,f,c;if(b){"string"===typeof b&&(b=JSON.parse(b));if(p(b)){c=[];d=0;for(f=b.length;d<f;d++)a=b[d],c.push(new this(a));return c}return new this(b)}};a.fromForm=function(){var b;return(b=new this).fromForm.apply(b,arguments)};a.recordsValues=function(){var b,a,d,c;a=[];c=this.records;for(b in c)d=c[b],a.push(d);return a};a.cloneArray=function(b){var a,d,c,g;g=[];d=0;for(c=b.length;d<c;d++)a=b[d],
g.push(a.clone());return g};a.idCounter=0;a.uid=function(){return this.idCounter++};a.prototype.isNew=function(){return!this.exists()};a.prototype.isValid=function(){return!this.validate()};a.prototype.validate=function(){};a.prototype.load=function(b){var a,d;for(a in b)if(d=b[a],"function"===typeof this[a])this[a](d);else this[a]=d;return this};a.prototype.attributes=function(){var b,a,d,c,g;a={};g=this.constructor.attributes;d=0;for(c=g.length;d<c;d++)b=g[d],b in this&&(a[b]="function"===typeof this[b]?
this[b]():this[b]);this.id&&(a.id=this.id);return a};a.prototype.eql=function(b){return!(!b||!(b.constructor===this.constructor&&(b.id===this.id||b.cid===this.cid)))};a.prototype.save=function(b){var a;null==b&&(b={});if(!1!==b.validate&&(a=this.validate()))return this.trigger("error",a),!1;this.trigger("beforeSave",b);a=this.isNew()?this.create(b):this.update(b);this.trigger("save",b);return a};a.prototype.updateAttribute=function(b,a){this[b]=a;return this.save()};a.prototype.updateAttributes=function(b,
a){this.load(b);return this.save(a)};a.prototype.changeID=function(b){var a;a=this.constructor.records;a[b]=a[this.id];delete a[this.id];this.id=b;return this.save()};a.prototype.destroy=function(b){null==b&&(b={});this.trigger("beforeDestroy",b);delete this.constructor.records[this.id];delete this.constructor.crecords[this.cid];this.destroyed=!0;this.trigger("destroy",b);this.trigger("change","destroy",b);this.unbind();return this};a.prototype.dup=function(b){var a;a=new this.constructor(this.attributes());
!1===b?a.cid=this.cid:delete a.id;return a};a.prototype.clone=function(){return Object.create(this)};a.prototype.reload=function(){var b;if(this.isNew())return this;b=this.constructor.find(this.id);this.load(b.attributes());return b};a.prototype.toJSON=function(){return this.attributes()};a.prototype.toString=function(){return"<"+this.constructor.className+" ("+JSON.stringify(this)+")>"};a.prototype.fromForm=function(b){var a,d,c,g;a={};g=l(b).serializeArray();d=0;for(c=g.length;d<c;d++)b=g[d],a[b.name]=
b.value;return this.load(a)};a.prototype.exists=function(){return this.id&&this.id in this.constructor.records};a.prototype.update=function(b){var a;this.trigger("beforeUpdate",b);a=this.constructor.records;a[this.id].load(this.attributes());a=a[this.id].clone();a.trigger("update",b);a.trigger("change","update",b);return a};a.prototype.create=function(b){var a;this.trigger("beforeCreate",b);this.id||(this.id=this.cid);a=this.dup(!1);this.constructor.records[this.id]=a;this.constructor.crecords[this.cid]=
a;a=a.clone();a.trigger("create",b);a.trigger("change","create",b);return a};a.prototype.bind=function(a,e){var c,f,g=this;this.constructor.bind(a,c=function(a){if(a&&g.eql(a))return e.apply(g,arguments)});this.constructor.bind("unbind",f=function(e){if(e&&g.eql(e))return g.constructor.unbind(a,c),g.constructor.unbind("unbind",f)});return c};a.prototype.one=function(a,e){var c,f=this;return c=this.bind(a,function(){f.constructor.unbind(a,c);return e.apply(f)})};a.prototype.trigger=function(){var a,
c;a=1<=arguments.length?k.call(arguments,0):[];a.splice(1,0,this);return(c=this.constructor).trigger.apply(c,a)};a.prototype.unbind=function(){return this.trigger("unbind")};return a}(j);m=function(c){function a(b){this.release=w(this.release,this);var c,d,f;f=this.options=b;for(c in f)d=f[c],this[c]=d;this.el||(this.el=document.createElement(this.tag));this.el=l(this.el);this.className&&this.el.addClass(this.className);this.attributes&&this.el.attr(this.attributes);this.release(function(){return this.el.remove()});
this.events||(this.events=this.constructor.events);this.elements||(this.elements=this.constructor.elements);this.events&&this.delegateEvents();this.elements&&this.refreshElements();a.__super__.constructor.apply(this,arguments)}q(a,c);a.include(n);a.include(r);a.prototype.eventSplitter=/^(\S+)\s*(.*)$/;a.prototype.tag="div";a.prototype.release=function(a){return"function"===typeof a?this.bind("release",a):this.trigger("release")};a.prototype.$=function(a){return l(a,this.el)};a.prototype.delegateEvents=
function(){var a,c,d,f,g,h;g=this.events;h=[];for(c in g)f=g[c],"function"!==typeof f&&(f=this.proxy(this[f])),d=c.match(this.eventSplitter),a=d[1],d=d[2],""===d?h.push(this.el.bind(a,f)):h.push(this.el.delegate(d,a,f));return h};a.prototype.refreshElements=function(){var a,c,d,f;d=this.elements;f=[];for(a in d)c=d[a],f.push(this[c]=this.$(a));return f};a.prototype.delay=function(a,c){return setTimeout(this.proxy(a),c||0)};a.prototype.html=function(a){this.el.html(a.el||a);this.refreshElements();
return this.el};a.prototype.append=function(){var a,c,d;c=1<=arguments.length?k.call(arguments,0):[];var f,g,h;h=[];f=0;for(g=c.length;f<g;f++)a=c[f],h.push(a.el||a);(d=this.el).append.apply(d,h);this.refreshElements();return this.el};a.prototype.appendTo=function(a){this.el.appendTo(a.el||a);this.refreshElements();return this.el};a.prototype.prepend=function(){var a,c,d;c=1<=arguments.length?k.call(arguments,0):[];var f,g,h;h=[];f=0;for(g=c.length;f<g;f++)a=c[f],h.push(a.el||a);(d=this.el).prepend.apply(d,
h);this.refreshElements();return this.el};a.prototype.replace=function(a){var c;c=[this.el,l(a.el||a)];a=c[0];this.el=c[1];a.replaceWith(this.el);this.delegateEvents();this.refreshElements();return this.el};return a}(j);l=("undefined"!==typeof window&&null!==window?window.jQuery:void 0)||("undefined"!==typeof window&&null!==window?window.Zepto:void 0)||function(c){return c};"function"!==typeof Object.create&&(Object.create=function(c){var a;a=function(){};a.prototype=c;return new a});p=function(c){return Object.prototype.toString.call(c)===
"[object Array]"};t=function(c){return Array.prototype.slice.call(c,0)};i=this.Spine={};"undefined"!==typeof module&&null!==module&&(module.exports=i);i.version="1.0.6";i.isArray=p;i.isBlank=function(c){var a;if(!c)return true;for(a in c)return false;return true};i.$=l;i.Events=n;i.Log=r;i.Module=j;i.Controller=m;i.Model=o;j.extend.call(i,n);j.create=j.sub=m.create=m.sub=o.sub=function(c,a){var b;b=function(a){function b(){b.__super__.constructor.apply(this,arguments)}q(b,a);return b}(this);c&&b.include(c);
a&&b.extend(a);typeof b.unbind==="function"&&b.unbind();return b};o.setup=function(c,a){var b;a==null&&(a=[]);b=function(a){function b(){b.__super__.constructor.apply(this,arguments)}q(b,a);return b}(this);b.configure.apply(b,[c].concat(k.call(a)));return b};j.init=m.init=o.init=function(c,a,b,e,d){return new this(c,a,b,e,d)};i.Class=j}).call(this);
